library(tidyverse)
library(perfilparlamentar)

#' @title Processa o Disciplina para o Parlametria
#' @description Recupera informações de disciplina partidária
#' para o parlametria usando o pacote perfilparlamentar
#' @param votos_datapath Caminho para o csv de votos.
#' @param orientacoes_datapath Caminho para o csv de orientações
#' @return Dataframe de parlamentares e a disciplina calculada.
#' @example
#' disciplina <- processa_disciplina(votos_datapath, orientacoes_datapath, votacoes_datapath)
processa_disciplina <-
  function(votos_datapath,
           orientacoes_datapath,
           votacoes_datapath,
           data_inicio = "2019-02-01",
           data_final = "2022-12-31") {
  votacoes <- read_csv(votacoes_datapath) %>%
    filter(data >= data_inicio, data <= data_final)
  
  votos <- read_csv(votos_datapath) %>% 
    filter(id_votacao %in% (votacoes %>% pull(id_votacao)))
  
  orientacoes <- read_csv(orientacoes_datapath) %>% 
    filter(id_votacao %in% (votacoes %>% pull(id_votacao)))
  
  if (nrow(votos) > 0 && nrow(orientacoes) > 0) {
    disciplina <- perfilparlamentar::processa_disciplina_partidaria(votos, orientacoes, FALSE)
  
  } else {
    disciplina <- tibble(
      id_parlamentar = integer(),
      id_parlamentar_parlametria = integer(),
      partido_disciplina = character(),
      partido_atual = character(),
      casa = character(),
      votos_validos = integer(),
      num_seguiu = integer(),
      disciplina = double(),
      bancada_suficiente = logical()
    )
  }
  
  
  return(disciplina)
}
