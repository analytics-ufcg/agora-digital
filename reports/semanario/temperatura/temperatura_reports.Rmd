---
title: "Relatório de temperatura na semana 16/09 a 20/09"
author: "Equipe Leg.go"
date: "26/09/2019"
output:
  prettydoc::html_pretty:
    theme: leonids
    highlight: github
---

```{r knitr_init, echo=FALSE, message=FALSE, warning=FALSE, cache=FALSE, paged.print=FALSE, results="asis"}
library(tidyverse)
library(here)
library(lubridate)
library(ggplot2)
```

```{r, message=FALSE, warning=FALSE, include=FALSE}
temperatura <- read_csv("../../../data/hists_temperatura.csv")
```


Base de dados de pressão que tiveram em pauta
```{r}
pressao_137999 <- read_csv("../../../../leggo-backend/data/pops/pop_137999.csv")
pressao_16526 <- read_csv("../../../../leggo-backend/data/pops/pop_16526.csv")
pressao_2192459 <- read_csv("../../../../leggo-backend/data/pops/pop_2192459.csv")
pressao <- bind_rows(pressao_137999, pressao_16526, pressao_2192459)
```

Primeiro passo: Verificar temperatura das proposições que tiveram na pauta da semana
- PEC 6/2019 - Nova previdência
- PL 1292/1995 - PL das compras públicas
- PL 5029/2018 - Uso do fundo partidário para remunerar funcionários de partido político -- sem dados de pressao
- MPV 884/2019 - Retira prazo para inscrição de propriedades no CAR -- sem dados de pressao

```{r, message=FALSE, warning=FALSE, include=FALSE}
ids_props_pauta <- c("137999", "16526", "2187087", "2208200", "2192459")

temperatura_pauta <- temperatura %>% 
  filter(id_ext %in% ids_props_pauta)
```

```{r}
temperatura_ <- temperatura_pauta %>% 
  select(-temperatura_periodo)

temperatura_$periodo <- date(temperatura_$periodo)

pressao_ <- pressao %>% 
  select(id_ext,
         periodo = date,
         casa,
         pressao = maximo_geral) 

pauta <- inner_join(temperatura_, pressao_)

```


```{r}
pauta_137999 <- pauta %>% 
  filter(id_ext %in% c("137999","2192459"))

pauta_137999 %>% 
  ggplot(aes(x = epiweek(periodo), y = log(temperatura_recente))) +
  geom_area(fill="#69b3a2", width=0.1)  +
  geom_col(aes(x = epiweek(periodo), y = -log(pressao)), fill= "#404080", width = 0.95) +
  xlab("Semana") +
  ylab("Temperatura recente") 
  
```

```{r}
pauta_137999 %>% 
  ggplot(aes(x = epiweek(periodo), y = temperatura_recente)) +
  geom_area(fill="#69b3a2", width=0.1)  +
  geom_area(aes(x = epiweek(periodo), y = -pressao), fill= "#404080", size = .3) 
```


Segundo passo: Verificar as proposições que tiveram aumento de temperatura
- PL 1292/1995 - PL das compras públicas
- PEC 15/2015 - Tornar o Fundeb permanente
- PL 7180/2014 - Escola sem partido

```{r, message=FALSE, warning=FALSE, include=FALSE}
temperatura_aumento <- temperatura %>% 
  filter(year(periodo) == "2019") %>% 
  mutate(semana = week(periodo)) %>% 
  filter(semana >= week("2019-09-08"))

```


```{r}

```


